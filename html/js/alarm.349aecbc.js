webpackJsonp([2],{"/3Fi":function(t,e,a){var r=a("oZGG");"string"==typeof r&&(r=[[t.i,r,""]]),r.locals&&(t.exports=r.locals);a("rjj0")("e4ad42a6",r,!0,{})},"2vSs":function(t,e,a){"use strict";var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("FormDlg",{ref:"dlg",attrs:{title:"编辑报警预案",disabled:t.errors.any()},on:{hide:t.onHide,show:t.onShow,submit:t.onSubmit}},[a("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.form.ID,expression:"form.ID",modifiers:{trim:!0}}],attrs:{type:"hidden",name:"ID"},domProps:{value:t.form.ID},on:{input:function(e){e.target.composing||t.$set(t.form,"ID",e.target.value.trim())},blur:function(e){t.$forceUpdate()}}}),t._v(" "),a("div",{staticClass:"col-md-12"},[a("div",{class:{"form-group":!0,"has-error":t.errors.has("Name")}},[a("label",{staticClass:"col-sm-4 control-label"},[t._v("名称\r\n                "),a("span",{staticClass:"text-red"},[t._v("*")])]),t._v(" "),a("div",{staticClass:"col-sm-7"},[a("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.form.Name,expression:"form.Name",modifiers:{trim:!0}},{name:"validate",rawName:"v-validate",value:"required",expression:"'required'"}],staticClass:"form-control",attrs:{type:"text",name:"Name","data-vv-as":"名称"},domProps:{value:t.form.Name},on:{input:function(e){e.target.composing||t.$set(t.form,"Name",e.target.value.trim())},blur:function(e){t.$forceUpdate()}}})])]),t._v(" "),a("div",{class:{"form-group":!0,"has-error":t.errors.has("Enable")}},[a("label",{staticClass:"col-sm-4 control-label"},[t._v("状态\r\n            ")]),t._v(" "),a("div",{staticClass:"col-sm-7 checkbox"},[a("el-checkbox",{staticStyle:{"margin-left":"-19px","margin-top":"-5px"},attrs:{size:"small",name:"Enable"},model:{value:t.form.Enable,callback:function(e){t.$set(t.form,"Enable","string"==typeof e?e.trim():e)},expression:"form.Enable"}},[t._v("\r\n                    启用  \r\n                ")])],1)]),t._v(" "),a("div",{class:{"form-group":!0,"has-error":t.errors.has("SnapInterval")}},[a("label",{staticClass:"col-sm-4 control-label",attrs:{title:"值为0 不截取快照"}},[t._v("快照周期(秒)\r\n                "),a("span",{staticClass:"text-red"},[t._v("*")])]),t._v(" "),a("div",{staticClass:"col-sm-7"},[a("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.form.SnapInterval,expression:"form.SnapInterval",modifiers:{trim:!0}},{name:"validate",rawName:"v-validate",value:"required|numeric|min_value:0",expression:"'required|numeric|min_value:0'"}],staticClass:"form-control",attrs:{type:"text",name:"SnapInterval",placeholder:"值为0 不截取快照","data-vv-as":"快照周期"},domProps:{value:t.form.SnapInterval},on:{input:function(e){e.target.composing||t.$set(t.form,"SnapInterval",e.target.value.trim())},blur:function(e){t.$forceUpdate()}}})])]),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:"标准版"!=t.serverInfo.VersionType,expression:"serverInfo.VersionType != '标准版'"}],class:{"form-group":!0,"has-error":t.errors.has("RecordDuration")}},[a("label",{staticClass:"col-sm-4 control-label",attrs:{title:"值为0 不录制视频"}},[t._v("录像时长(秒)\r\n                "),a("span",{staticClass:"text-red"},[t._v("*")])]),t._v(" "),a("div",{staticClass:"col-sm-7"},[a("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.form.RecordDuration,expression:"form.RecordDuration",modifiers:{trim:!0}},{name:"validate",rawName:"v-validate",value:"required|numeric|min_value:0",expression:"'required|numeric|min_value:0'"}],staticClass:"form-control",attrs:{type:"text",name:"RecordDuration",placeholder:"值为0 不录制视频","data-vv-as":"录像时长"},domProps:{value:t.form.RecordDuration},on:{input:function(e){e.target.composing||t.$set(t.form,"RecordDuration",e.target.value.trim())},blur:function(e){t.$forceUpdate()}}})])]),t._v(" "),a("div",{staticClass:"form-group"},[a("label",{staticClass:"col-sm-4 control-label"},[t._v("报警级别")]),t._v(" "),a("div",{staticClass:"col-sm-7"},[a("el-select",{staticStyle:{width:"100%"},attrs:{size:"medium",multiple:"",filterable:"",placeholder:"全部"},model:{value:t.priority,callback:function(e){t.priority="string"==typeof e?e.trim():e},expression:"priority"}},t._l(t.priorityList,function(t,e){return a("el-option",{key:e,attrs:{label:t.name,value:t.code}})}))],1)]),t._v(" "),a("div",{staticClass:"form-group"},[a("label",{staticClass:"col-sm-4 control-label"},[t._v("报警方式")]),t._v(" "),a("div",{staticClass:"col-sm-7"},[a("el-select",{staticStyle:{width:"100%"},attrs:{size:"medium",multiple:"",filterable:"",placeholder:"全部"},model:{value:t.method,callback:function(e){t.method="string"==typeof e?e.trim():e},expression:"method"}},t._l(t.methodList,function(t,e){return a("el-option",{key:e,attrs:{label:t.name,value:t.code}})}))],1)]),t._v(" "),t.typeList.length?a("div",{staticClass:"form-group"},[a("label",{staticClass:"col-sm-4 control-label"},[t._v("报警类型")]),t._v(" "),a("div",{staticClass:"col-sm-7"},[a("el-select",{staticStyle:{width:"100%"},attrs:{size:"medium",multiple:"",filterable:"",placeholder:"全部"},model:{value:t.type,callback:function(e){t.type="string"==typeof e?e.trim():e},expression:"type"}},t._l(t.typeList,function(t,e){return a("el-option",{key:e,attrs:{label:t.name,value:t.code}})}))],1)]):t._e(),t._v(" "),t.eventTypeList.length?a("div",{staticClass:"form-group"},[a("label",{staticClass:"col-sm-4 control-label"},[t._v("入侵报警事件类型")]),t._v(" "),a("div",{staticClass:"col-sm-7"},[a("el-select",{staticStyle:{width:"100%"},attrs:{size:"medium",multiple:"",filterable:"",placeholder:"全部"},model:{value:t.eventType,callback:function(e){t.eventType="string"==typeof e?e.trim():e},expression:"eventType"}},t._l(t.eventTypeList,function(t,e){return a("el-option",{key:e,attrs:{label:t.name,value:t.code}})}))],1)]):t._e()]),t._v(" "),a("div",{staticClass:"clearfix"})])},n=[],o={render:r,staticRenderFns:n};e.a=o},"49HP":function(t,e,a){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});var r=a("PJh5"),n=function(t){return t&&t.__esModule?t:{default:t}}(r);e.default={data:function(){return{flags:{},defaultFlags:"0000000000000000000000000000000"}},props:{placeholder:{default:"选择日期"},clearBtn:{type:Boolean,default:!1},day:{default:""}},mounted:function(){var e=this;t(this.$el).datepicker({language:"zh-CN",autoclose:!0,clearBtn:this.clearBtn,format:"yyyy-mm-dd",todayHighlight:!0}).on("changeDate",function(t){t.date?e.$emit("update:day",(0,n.default)(t.date).format("YYYYMMDD")):e.$emit("update:day","")}).on("change",function(){e.$el.value||e.$emit("update:day","")}),this.day&&t(this.$el).datepicker("setDate",(0,n.default)(this.day,"YYYYMMDD").toDate()),this.update()},watch:{day:function(e){if(e){var a=t(this.$el).datepicker("getDate");e!=(0,n.default)(a).format("YYYYMMDD")&&t(this.$el).datepicker("setDate",(0,n.default)(e,"YYYYMMDD").toDate())}}},computed:{},methods:{update:function(){t(this.$el).datepicker("update")}}}}).call(e,a("0iPh"))},"5Ggk":function(t,e,a){"use strict";(function(t){function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var n=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(t[r]=a[r])}return t},o=a("M4fF"),i=r(o),s=a("WEd6"),l=r(s),c=a("NYxO"),u=a("PJh5"),d=r(u);e.default={props:{},data:function(){return{q:"",priority:"",method:"",starttime:"",endtime:"",total:0,pageSize:10,currentPage:1,sort:"Time",order:"desc",loading:!1,timer:0,alarms:[],alarmPublishToRedis:!1}},computed:n({},(0,c.mapState)(["userInfo","serverInfo"])),components:{DatePicker:l.default},mounted:function(){},beforeDestroy:function(){this.timer&&(clearInterval(this.timer),this.timer=0)},methods:{ready:function(){this.$watch("q",function(t,e){this.doDelaySearch()}),this.$watch("starttime",function(t,e){this.doSearch()}),this.$watch("endtime",function(t,e){this.doSearch()}),this.$watch("priority",function(t,e){this.doSearch()}),this.$watch("method",function(t,e){this.doSearch()}),this.$watch("currentPage",function(t,e){this.doSearch(t)})},doSearch:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e={};this.q&&(e.q=this.q),this.starttime&&(e.starttime=this.starttime),this.endtime&&(e.endtime=this.endtime),this.priority&&(e.priority=this.priority),this.method&&(e.method=this.method),this.$router.replace({path:"/alarms/"+t,query:e})},doDelaySearch:i.default.debounce(function(){this.doSearch()},800),getAlarms:function(){var e=this,a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];a&&(this.loading=!0),t.ajax({method:"GET",url:"/api/v1/alarm/list",global:a,data:{q:this.q,start:(this.currentPage-1)*this.pageSize,limit:this.pageSize,starttime:this.starttime?(0,d.default)(this.starttime,"YYYYMMDD").startOf("day").format("YYYY-MM-DDTHH:mm:ss"):"",endtime:this.endtime?(0,d.default)(this.endtime,"YYYYMMDD").endOf("day").format("YYYY-MM-DDTHH:mm:ss"):"",priority:this.priority,method:this.method,sort:this.sort,order:this.order}}).then(function(t){e.total=t.AlarmCount,e.alarms=t.AlarmList,e.alarmPublishToRedis=t.AlarmPublishToRedis}).always(function(){a&&e.$nextTick(function(){e.loading=!1})})},sortChange:function(t){this.sort=t.prop,this.order="ascending"==t.order?"asc":"desc",this.getAlarms()},formatName:function(t,e,a){return a||"-"},formatDevice:function(t,e,a){return t.DeviceID?t.DeviceID:"-"},formatChannel:function(t,e,a){return t.ChannelID?t.ChannelID:"-"},formatPriority:function(t,e,a){return t.AlarmPriorityName||t.AlarmPriority||"-"},formatMethod:function(t,e,a){return t.AlarmMethodName||t.AlarmMethod||"-"},formatType:function(t,e,a){return t.AlarmTypeName||t.AlarmType||t.AlarmDescription||"-"},showStartDatePicker:function(){t(this.$refs.startDatePicker.$el).focus()},showEndDatePicker:function(){t(this.$refs.endDatePicker.$el).focus()},removeAlarm:function(e){var a=this;this.$confirm("确认删除","提示",{lockScroll:!1}).then(function(){t.post("/api/v1/alarm/remove",{id:e.ID}).always(function(){a.getAlarms()})}).catch(function(){})},clearAlarm:function(){var e=this;this.$confirm("确认全部删除","提示",{lockScroll:!1}).then(function(){t.post("/api/v1/alarm/clear",{}).then(function(){e.getAlarms()})}).catch(function(){})},downloadRecord:function(t){window.open(t,"_blank")},playRecord:function(t){window.open(t.replace("/api/v1/downloads/","/api/v1/play/"),"_blank")}},beforeRouteEnter:function(t,e,a){a(function(e){e.q=t.query.q||"",e.starttime=t.query.starttime||"",e.endtime=t.query.endtime||"",e.priority=t.query.priority||"",e.method=t.query.method||"",e.currentPage=parseInt(t.params.page)||1,e.ready()})},beforeRouteUpdate:function(t,e,a){var r=this;a(),this.$nextTick(function(){r.q=t.query.q||"",r.starttime=t.query.starttime||"",r.endtime=t.query.endtime||"",r.priority=t.query.priority||"",r.method=t.query.method||"",r.currentPage=parseInt(t.params.page)||1,r.alarms=[],r.total=0,r.getAlarms()})}}}).call(e,a("0iPh"))},"5gxX":function(t,e,a){"use strict";function r(t){a("LbQQ")}Object.defineProperty(e,"__esModule",{value:!0});var n=a("qb8i"),o=a.n(n);for(var i in n)["default","default"].indexOf(i)<0&&function(t){a.d(e,t,function(){return n[t]})}(i);var s=a("lGU5"),l=a("VU/8"),c=r,u=l(o.a,s.a,!1,c,null,null);e.default=u.exports},AbGX:function(t,e,a){"use strict";var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"box box-primary"},[t._m(0),t._v(" "),a("div",{staticClass:"box-body"},[t.hasAnyRole(t.serverInfo,t.userInfo,"超级管理员")?a("div",{staticClass:"form-inline",attrs:{autocomplete:"off",spellcheck:"false"}},[a("div",{staticClass:"form-group form-group-sm",staticStyle:{display:"inline-block"}},[a("div",{staticClass:"input-group input-group-sm"},[a("router-link",{staticClass:"btn btn-sm btn-primary",attrs:{to:"/alarms/plans/1"}},[a("i",{staticClass:"fa fa-calendar-check-o"}),t._v(" 报警预案\n                        ")])],1)]),t._v(" "),a("div",{staticClass:"form-group form-group-sm pull-right",staticStyle:{display:"inline-block"}},[a("div",{staticClass:"input-group input-group-sm"},[a("button",{staticClass:"btn btn-sm btn-danger",attrs:{type:"button"},on:{click:function(e){e.preventDefault(),t.clearAlarm(e)}}},[a("i",{staticClass:"fa fa-remove"}),t._v(" 清空\n                        ")])])])]):t._e(),t._v(" "),t.hasAnyRole(t.serverInfo,t.userInfo,"超级管理员")?a("br",{staticClass:"hidden-xs"}):t._e(),t._v(" "),t.hasAnyRole(t.serverInfo,t.userInfo,"超级管理员")?a("div",{staticClass:"clearfix"}):t._e(),t._v(" "),a("div",{staticClass:"form-inline",attrs:{autocomplete:"off",spellcheck:"false"}},[a("div",{staticClass:"form-group form-group-sm"},[a("label",[t._v("搜索")]),t._v(" "),a("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.q,expression:"q",modifiers:{trim:!0}}],ref:"q",staticClass:"form-control",attrs:{type:"text",placeholder:"关键字"},domProps:{value:t.q},on:{keydown:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;e.preventDefault()},input:function(e){e.target.composing||(t.q=e.target.value.trim())},blur:function(e){t.$forceUpdate()}}})]),t._v(" "),a("span",{staticClass:"hidden-xs"},[t._v("  ")]),t._v(" "),a("div",{staticClass:"form-group form-group-sm"},[a("label",[t._v("报警级别")]),t._v(" "),a("select",{directives:[{name:"model",rawName:"v-model.trim",value:t.priority,expression:"priority",modifiers:{trim:!0}}],staticClass:"form-control",on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.priority=e.target.multiple?a:a[0]}}},[a("option",{attrs:{value:""}},[t._v("全部")]),t._v(" "),a("option",{attrs:{value:"1"}},[t._v("一级警情")]),t._v(" "),a("option",{attrs:{value:"2"}},[t._v("二级警情")]),t._v(" "),a("option",{attrs:{value:"3"}},[t._v("三级警情")]),t._v(" "),a("option",{attrs:{value:"4"}},[t._v("四级警情")])])]),t._v(" "),a("span",{staticClass:"hidden-xs"},[t._v("  ")]),t._v(" "),a("div",{staticClass:"form-group form-group-sm"},[a("label",[t._v("报警方式")]),t._v(" "),a("select",{directives:[{name:"model",rawName:"v-model.trim",value:t.method,expression:"method",modifiers:{trim:!0}}],staticClass:"form-control",on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.method=e.target.multiple?a:a[0]}}},[a("option",{attrs:{value:""}},[t._v("全部")]),t._v(" "),a("option",{attrs:{value:"1"}},[t._v("电话报警")]),t._v(" "),a("option",{attrs:{value:"2"}},[t._v("设备报警")]),t._v(" "),a("option",{attrs:{value:"3"}},[t._v("短信报警")]),t._v(" "),a("option",{attrs:{value:"4"}},[t._v("GPS报警")]),t._v(" "),a("option",{attrs:{value:"5"}},[t._v("视频报警")]),t._v(" "),a("option",{attrs:{value:"6"}},[t._v("设备故障报警")]),t._v(" "),a("option",{attrs:{value:"7"}},[t._v("其他报警")])])]),t._v(" "),a("span",{staticClass:"hidden-xs"},[t._v("  ")]),t._v(" "),a("div",{staticClass:"form-group"},[a("div",{staticClass:"input-group input-group-sm"},[a("DatePicker",{ref:"startDatePicker",staticClass:"form-control input-group-sm",attrs:{clearBtn:"",day:t.starttime,placeholder:"开始日期"},on:{"update:day":function(e){t.starttime=e}}}),t._v(" "),a("div",{staticClass:"input-group-btn"},[a("button",{staticClass:"btn btn-sm btn-default",attrs:{type:"button"},on:{click:function(e){e.preventDefault(),t.showStartDatePicker(e)}}},[a("i",{staticClass:"fa fa-calendar"})])])],1)]),t._v(" "),a("span",{staticClass:"hidden-xs"},[t._v(" - ")]),t._v(" "),a("div",{staticClass:"form-group"},[a("div",{staticClass:"input-group input-group-sm"},[a("DatePicker",{ref:"endDatePicker",staticClass:"form-control input-group-sm",attrs:{clearBtn:"",day:t.endtime,placeholder:"结束日期"},on:{"update:day":function(e){t.endtime=e}}}),t._v(" "),a("div",{staticClass:"input-group-btn"},[a("button",{staticClass:"btn btn-sm btn-default",attrs:{type:"button"},on:{click:function(e){e.preventDefault(),t.showEndDatePicker(e)}}},[a("i",{staticClass:"fa fa-calendar"})])])],1)])]),t._v(" "),a("br"),t._v(" "),a("div",{staticClass:"clearfix"}),t._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{data:t.alarms,stripe:"","default-sort":{prop:"Time",order:"descending"},"element-loading-text":"加载中..."},on:{"sort-change":t.sortChange}},[a("el-table-column",{attrs:{prop:"DeviceID",label:"报警设备","min-width":"200",formatter:t.formatDevice,"show-overflow-tooltip":""}}),t._v(" "),a("el-table-column",{attrs:{prop:"ChannelID",label:"报警通道","min-width":"200",formatter:t.formatChannel,"show-overflow-tooltip":""}}),t._v(" "),a("el-table-column",{attrs:{prop:"ChannelName",label:"通道名称","min-width":"120","show-overflow-tooltip":""}}),t._v(" "),a("el-table-column",{attrs:{label:"操作","min-width":"100",fixed:!t.isMobile()&&"right"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"btn-group btn-group-xs"},[t.hasAnyRole(t.serverInfo,t.userInfo,"管理员")?a("button",{staticClass:"btn btn-danger",attrs:{type:"button"},on:{click:function(a){a.preventDefault(),t.removeAlarm(e.row)}}},[a("i",{staticClass:"fa fa-remove"}),t._v(" 删除\n                            ")]):t._e()])]}}])}),t._v(" "),a("el-table-column",{attrs:{"min-width":"100",label:"关联快照"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.SnapPath?a("el-popover",{attrs:{"open-delay":1e3,"close-delay":10,placement:"left",title:e.row.ChannelID,width:"400",trigger:"hover"}},[a("img",{staticStyle:{width:"100%",height:"100%"},attrs:{onerror:"this.src='/images/default_snap.png';",src:e.row.SnapPath}}),t._v(" "),a("img",{staticStyle:{height:"30px",width:"50px"},attrs:{slot:"reference",onerror:"this.src='/images/default_snap.png';",src:e.row.SnapPath},slot:"reference"})]):a("span",{attrs:{title:e.row.PlanDescription}},[a("i",[t._v("-")])])]}}])}),t._v(" "),t.hasAnyRole(t.serverInfo,t.userInfo,"管理员","超级管理员")&&"标准版"!=t.serverInfo.VersionType?a("el-table-column",{attrs:{"min-width":"200",label:"关联录像","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.RecordPath?a("div",{staticClass:"btn-group btn-group-xs"},[a("button",{staticClass:"btn btn-primary",attrs:{type:"button",title:"点击到新选项卡播放"},on:{click:function(a){a.preventDefault(),t.playRecord(e.row.RecordPath)}}},[a("i",{staticClass:"fa fa-play-circle"},[t._v(" 播放")])]),t._v(" "),a("button",{staticClass:"btn btn-warning",attrs:{type:"button",title:"点击到新选项卡下载"},on:{click:function(a){a.preventDefault(),t.downloadRecord(e.row.RecordPath)}}},[a("i",{staticClass:"fa fa-download"},[t._v(" 下载")])]),t._v(" "),a("button",{directives:[{name:"clipboard",rawName:"v-clipboard",value:e.row.RecordPath,expression:"props.row.RecordPath"}],staticClass:"btn btn-info",attrs:{type:"button",title:"点击拷贝链接到粘贴板"},on:{success:function(e){t.$message({type:"success",message:"成功拷贝到粘贴板"})}}},[a("i",{staticClass:"fa fa-copy"}),t._v(" 链接")])]):a("span",{attrs:{title:e.row.PlanDescription}},[a("i",[t._v("-")])])]}}])}):t._e(),t._v(" "),a("el-table-column",{attrs:{prop:"AlarmPriority",label:"报警级别","min-width":"100",formatter:t.formatPriority,"show-overflow-tooltip":"",sortable:"custom"}}),t._v(" "),a("el-table-column",{attrs:{prop:"AlarmMethod",label:"报警方式","min-width":"100",formatter:t.formatMethod,"show-overflow-tooltip":""}}),t._v(" "),a("el-table-column",{attrs:{prop:"AlarmType",label:"报警类型","min-width":"140",formatter:t.formatType,"show-overflow-tooltip":""}}),t._v(" "),a("el-table-column",{attrs:{prop:"Time",label:"报警时间","min-width":"160",sortable:"custom"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.Time&&"0001-01-01 00:00:00"!=e.row.Time?a("span",[t._v(t._s(e.row.Time))]):a("span",{staticClass:"text-orange"},[t._v(t._s(e.row.CreatedAt))])]}}])}),t._v(" "),a("template",{attrs:{slot:"empty"},slot:"empty"},[t._v("\n                    暂无数据, 请在 "),a("router-link",{attrs:{to:"/devices"}},[t._v("国标设备")]),t._v(" 》 编辑 》 订阅项目 》 开启 报警订阅\n                ")],1)],2)],1),t._v(" "),t.total>0?a("div",{staticClass:"box-footer"},[a("el-pagination",{staticClass:"pull-right",attrs:{layout:"total,prev,pager,next","pager-count":t.isMobile()?3:5,total:t.total,"page-size":t.pageSize,"current-page":t.currentPage},on:{"update:pageSize":function(e){t.pageSize=e},"update:currentPage":function(e){t.currentPage=e}}})],1):t._e()]),t._v(" "),t.alarmPublishToRedis&&t.serverInfo.DemoUser?a("div",{staticClass:"alert text-center"},[t._m(1)]):t._e()])},n=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"box-header"},[a("h4",{staticClass:"text-primary text-center"},[t._v("报警列表")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("small",[a("strong",[a("i",{staticClass:"fa fa-info-circle"}),t._v(" 提示 : ")]),t._v("\n            已开启报警消息发布到 Redis, 可向 Redis 订阅 alarm 消息以获取实时报警 > SUBSCRIBE alarm 消息内容为报警信息 JSON 序列化字符串\n        ")])}],o={render:r,staticRenderFns:n};e.a=o},Azn9:function(t,e,a){e=t.exports=a("FZ+f")(!1),e.push([t.i,".modal-content[data-v-306f3c83]{overflow:hidden}@media screen and (min-width:992px){.modal-dialog.modal-lgg[data-v-306f3c83]{width:90%}}@media screen and (min-width:1200px){.modal-dialog.modal-lgg[data-v-306f3c83]{width:1200px}}",""])},ExkK:function(t,e,a){"use strict";function r(t){a("/3Fi")}Object.defineProperty(e,"__esModule",{value:!0});var n=a("jjVl"),o=a.n(n);for(var i in n)["default","default"].indexOf(i)<0&&function(t){a.d(e,t,function(){return n[t]})}(i);var s=a("rgK0"),l=a("VU/8"),c=r,u=l(o.a,s.a,!1,c,null,null);e.default=u.exports},G5yr:function(t,e,a){e=t.exports=a("FZ+f")(!1),e.push([t.i,".datepicker{z-index:9999!important}",""])},IEpb:function(t,e,a){var r=a("G5yr");"string"==typeof r&&(r=[[t.i,r,""]]),r.locals&&(t.exports=r.locals);a("rjj0")("47dd6f6e",r,!0,{})},IJ96:function(t,e,a){var r=a("Azn9");"string"==typeof r&&(r=[[t.i,r,""]]),r.locals&&(t.exports=r.locals);a("rjj0")("543b9640",r,!0,{})},LbQQ:function(t,e,a){var r=a("rF1v");"string"==typeof r&&(r=[[t.i,r,""]]),r.locals&&(t.exports=r.locals);a("rjj0")("080cae9a",r,!0,{})},Of5B:function(t,e,a){var r=a("ddz4");"string"==typeof r&&(r=[[t.i,r,""]]),r.locals&&(t.exports=r.locals);a("rjj0")("c287aa1c",r,!0,{})},"PP+z":function(t,e,a){"use strict";var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{class:["modal",{fade:t.fade}],attrs:{"data-backdrop":"static","data-disable":"false","data-keyboard":"true",tabindex:"-1"}},[a("div",{class:["modal-dialog",t.size]},[a("div",{staticClass:"modal-content"},[a("div",{staticClass:"modal-header"},[t._m(0),t._v(" "),a("h4",{staticClass:"modal-title text-center text-primary"},[a("span",[t._v(t._s(t.title))])])]),t._v(" "),a("div",{staticClass:"modal-body"},[a("div",{staticClass:"form-inline",attrs:{autocomplete:"off",spellcheck:"false"}},[a("div",{staticClass:"form-group form-group-sm"},[a("label",[t._v("搜索")]),t._v(" "),a("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.q,expression:"q",modifiers:{trim:!0}}],ref:"q",staticClass:"form-control",attrs:{type:"text",placeholder:"关键字"},domProps:{value:t.q},on:{keydown:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;e.preventDefault()},input:function(e){e.target.composing||(t.q=e.target.value.trim())},blur:function(e){t.$forceUpdate()}}})]),t._v(" "),a("span",{staticClass:"hidden-xs"},[t._v("  ")]),t._v(" "),a("div",{staticClass:"form-group form-group-sm"},[a("label",[t._v("报警订阅状态")]),t._v(" "),a("select",{directives:[{name:"model",rawName:"v-model.trim",value:t.subscribed,expression:"subscribed",modifiers:{trim:!0}}],staticClass:"form-control",on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.subscribed=e.target.multiple?a:a[0]}}},[a("option",{attrs:{value:""}},[t._v("全部")]),t._v(" "),a("option",{attrs:{value:"true"}},[t._v("已订阅")]),t._v(" "),a("option",{attrs:{value:"false"}},[t._v("未订阅")])])]),t._v(" "),a("span",{staticClass:"hidden-xs"},[t._v("  ")]),t._v(" "),a("div",{staticClass:"form-group form-group-sm"},[a("label",[t._v("在线状态")]),t._v(" "),a("select",{directives:[{name:"model",rawName:"v-model.trim",value:t.online,expression:"online",modifiers:{trim:!0}}],staticClass:"form-control",on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.online=e.target.multiple?a:a[0]}}},[a("option",{attrs:{value:""}},[t._v("全部")]),t._v(" "),a("option",{attrs:{value:"true"}},[t._v("在线")]),t._v(" "),a("option",{attrs:{value:"false"}},[t._v("离线")])])]),t._v(" "),a("span",{staticClass:"hidden-xs"},[t._v("  ")]),t._v(" "),a("div",{staticClass:"form-group form-group-sm"},[a("div",{staticClass:"checkbox",staticStyle:{"user-select":"none"}},[a("el-checkbox",{staticStyle:{"margin-top":"-5px","padding-left":"0"},attrs:{size:"small",name:"Related"},model:{value:t.related,callback:function(e){t.related="string"==typeof e?e.trim():e},expression:"related"}},[t._v("\r\n                                只看"+t._s(t.reverse?"未选":"已选")+"("+t._s(t.relateCnt)+")\r\n                            ")]),t._v(" "),a("span",[a("a",{attrs:{role:"button"},on:{click:t.toggleReverse}},[a("i",{staticClass:"fa fa-sort"})])])],1)])]),t._v(" "),a("br"),t._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],ref:"channelTable",attrs:{data:t.channels,stripe:"","max-height":500,"element-loading-text":"加载中..."},on:{"sort-change":t.sortChange,select:t.select,"select-all":t.selectAll}},[a("el-table-column",{attrs:{type:"selection",width:"55",fixed:"",selectable:t.selectable}}),t._v(" "),a("el-table-column",{attrs:{prop:"DeviceID",label:"设备国标编号","min-width":"200","show-overflow-tooltip":"",sortable:"custom"}}),t._v(" "),a("el-table-column",{attrs:{prop:"ID",label:"通道国标编号","min-width":"200","show-overflow-tooltip":"",sortable:"custom"}}),t._v(" "),a("el-table-column",{attrs:{prop:"Name",label:"通道名称","min-width":"160",formatter:t.formatName,"show-overflow-tooltip":""}}),t._v(" "),a("el-table-column",{attrs:{"min-width":"100",label:"快照"},scopedSlots:t._u([{key:"default",fn:function(e){return[t.isDir(e.row)?a("span",[a("i",{staticClass:"fa fa-sitemap"})]):a("el-popover",{attrs:{"open-delay":1e3,"close-delay":10,placement:"left",title:e.row.ID,width:"400",trigger:"hover"}},[a("img",{staticStyle:{width:"100%",height:"100%"},attrs:{onerror:"this.src='/images/default_snap.png';",src:e.row.SnapURL}}),t._v(" "),a("img",{staticStyle:{height:"30px",width:"50px"},attrs:{slot:"reference",onerror:"this.src='/images/default_snap.png';",src:e.row.SnapURL},slot:"reference"})])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"AlarmSubscribe",label:"报警订阅状态","min-width":"140",formatter:t.formatAlarmSubscribe,"show-overflow-tooltip":""}}),t._v(" "),a("el-table-column",{attrs:{prop:"Status",label:"在线状态","min-width":"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[t.isDir(e.row)?a("span",[t._v("-")]):e.row.DeviceOnline&&"ON"==(e.row.CustomStatus||e.row.Status)?a("span",{class:{"text-success":"ON"==e.row.Status,"text-orange":!!e.row.CustomStatus}},[t._v("在线")]):a("span",{class:{"text-orange":!!e.row.CustomStatus}},[t._v("离线")])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"Manufacturer",label:"厂家","min-width":"120",formatter:t.formatManufacturer,"show-overflow-tooltip":""}})],1),t._v(" "),t.total>0?a("el-pagination",{staticClass:"pull-right",attrs:{layout:"total,prev,pager,next,sizes","pager-count":t.isMobile()?3:5,total:t.total,"page-size":t.pageSize,"current-page":t.currentPage},on:{"update:pageSize":function(e){t.pageSize=e},"update:currentPage":function(e){t.currentPage=e}}}):t._e(),t._v(" "),a("div",{staticClass:"clearfix"})],1)])])])},n=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"modal","aria-label":"Close"}},[a("span",{attrs:{"aria-hidden":"true"}},[t._v("×")])])}],o={render:r,staticRenderFns:n};e.a=o},Vw9A:function(t,e,a){"use strict";function r(t){a("IJ96")}Object.defineProperty(e,"__esModule",{value:!0});var n=a("uaBg"),o=a.n(n);for(var i in n)["default","default"].indexOf(i)<0&&function(t){a.d(e,t,function(){return n[t]})}(i);var s=a("PP+z"),l=a("VU/8"),c=r,u=l(o.a,s.a,!1,c,"data-v-306f3c83",null);e.default=u.exports},WEd6:function(t,e,a){"use strict";function r(t){a("IEpb")}Object.defineProperty(e,"__esModule",{value:!0});var n=a("49HP"),o=a.n(n);for(var i in n)["default","default"].indexOf(i)<0&&function(t){a.d(e,t,function(){return n[t]})}(i);var s=a("u/lO"),l=a("VU/8"),c=r,u=l(o.a,s.a,!1,c,null,null);e.default=u.exports},ddz4:function(t,e,a){e=t.exports=a("FZ+f")(!1),e.push([t.i,".model-lg[data-v-c396325e]{width:80%!important}",""])},iFpf:function(t,e,a){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function n(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,a){function r(n,o){try{var i=e[n](o),s=i.value}catch(t){return void a(t)}if(!i.done)return Promise.resolve(s).then(function(t){r("next",t)},function(t){r("throw",t)});t(s)}return r("next")})}}Object.defineProperty(e,"__esModule",{value:!0});var o=a("A9K1"),i=r(o),s=a("0iPh"),l=r(s);e.default={props:{serverInfo:{type:Object,default:function(){}},userInfo:{type:Object,default:function(){return null}}},data:function(){return{form:this.defForm(),priorityList:[{code:"1",name:"一级警情"},{code:"2",name:"二级警情"},{code:"3",name:"三级警情"},{code:"4",name:"四级警情"}],methodList:[{code:"1",name:"电话报警"},{code:"2",name:"设备报警"},{code:"3",name:"短信报警"},{code:"4",name:"GPS报警"},{code:"5",name:"视频报警"},{code:"6",name:"设备故障报警"},{code:"7",name:"其他报警"}],priority:[],method:[],type:[],eventType:[]}},computed:{eventTypeList:function(){var t=[];return(this.method.indexOf("5")>=0||!this.method.length)&&(this.type.indexOf("5-6")>=0||!this.type.length)&&t.push({code:"1",name:"进入区域"},{code:"2",name:"离开区域"}),t.length||(this.eventType=[]),t},typeList:function(){var t=[];return(this.method.indexOf("2")>=0||!this.method.length)&&t.push({code:"2-1",name:"视频丢失报警"},{code:"2-2",name:"设备防拆报警"},{code:"2-3",name:"存储设备磁盘满报警"},{code:"2-4",name:"设备高温报警"},{code:"2-5",name:"设备低温报警"}),(this.method.indexOf("5")>=0||!this.method.length)&&t.push({code:"5-1",name:"人工视频报警"},{code:"5-2",name:"运动目标检测报警"},{code:"5-3",name:"遗留物检测报警"},{code:"5-4",name:"物体移除检测报警"},{code:"5-5",name:"绊线检测报警"},{code:"5-6",name:"入侵检测报警"},{code:"5-7",name:"逆行检测报警"},{code:"5-8",name:"徘徊检测报警"},{code:"5-9",name:"流量统计报警"},{code:"5-10",name:"密度检测报警"},{code:"5-11",name:"视频异常检测报警"},{code:"5-12",name:"快速移动报警"},{code:"5-13",name:"图像遮挡报警"}),(this.method.indexOf("6")>=0||!this.method.length)&&t.push({code:"6-1",name:"存储设备磁盘故障报警"},{code:"6-2",name:"存储设备风扇故障报警"}),t.length||(this.type=[]),t}},components:{FormDlg:i.default},methods:{defForm:function(){return{ID:"",Name:"",Enable:!1,SnapInterval:30,RecordDuration:15,Priority:"",Method:"",Type:"",EventType:""}},onHide:function(){this.form=this.defForm()},onShow:function(){this.errors.clear()},onSubmit:function(){var t=this;return n(regeneratorRuntime.mark(function e(){var a,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.$validator.validateAll();case 2:if(a=e.sent){e.next=8;break}return r=t.errors.items[0],t.$message({type:"error",message:r.msg}),(0,l.default)("[name="+r.field+"]").focus(),e.abrupt("return");case 8:t.form.Priority=t.priority.join(","),t.form.Method=t.method.join(","),t.form.Type=t.type.join(","),t.form.EventType=t.eventType.join(","),l.default.post("/api/v1/alarm/plan/save",{ID:t.form.ID,Name:t.form.Name,SnapInterval:t.form.SnapInterval,RecordDuration:t.form.RecordDuration,Priority:t.form.Priority,Method:t.form.Method,Type:t.form.Type,EventType:t.form.EventType,Enable:t.form.Enable}).then(function(e){t.$refs.dlg.hide(),t.$emit("submit")});case 13:case"end":return e.stop()}},e,t)}))()},show:function(t){var e=this;this.errors.clear(),t&&Object.assign(this.form,t),this.form.Priority?this.priority=this.form.Priority.split(","):this.priority=[],this.form.Method?this.method=this.form.Method.split(","):this.method=[],this.form.Type?this.type=this.form.Type.split(","):this.type=[],this.form.EventType?this.eventType=this.form.EventType.split(","):this.eventType=[],this.$nextTick(function(){e.$refs.dlg.show()})}}}},jjVl:function(t,e,a){"use strict";(function(t){function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var n=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(t[r]=a[r])}return t},o=a("M4fF"),i=r(o),s=a("5gxX"),l=r(s),c=a("yW/O"),u=r(c),d=a("Vw9A"),f=r(d),m=a("NYxO");e.default={data:function(){return{q:"",online:"",total:0,pageSize:10,currentPage:1,sort:"Name",order:"asc",loading:!1,bgLoading:!1,timer:0,alarmPlans:[],alarmPlanChannelListDlgTitle:"选择通道"}},computed:n({},(0,m.mapState)(["userInfo","serverInfo"])),components:{UploadDlg:l.default,AlarmPlanEditDlg:u.default,AlarmPlanChannelListDlg:f.default},mounted:function(){},methods:{ready:function(){var t=this;this.$watch("q",function(t,e){this.doDelaySearch()}),this.$watch("online",function(t,e){this.doSearch(t)}),this.$watch("currentPage",function(t,e){this.doSearch(t)}),this.timer=setInterval(function(){t.getAlarmPlans(!1)},3e3)},doSearch:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e={};this.q&&(e.q=this.q),this.online&&(e.online=this.online),this.$router.replace({path:"/alarms/plans/"+t,query:e})},doDelaySearch:i.default.debounce(function(){this.doSearch()},800),getAlarmPlans:function(){var e=this,a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(a)this.loading=!0;else{if(this.bgLoading||this.loading)return;this.bgLoading=!0}t.ajax({method:"GET",url:"/api/v1/alarm/plan/list",global:a,data:{q:this.q,start:(this.currentPage-1)*this.pageSize,limit:this.pageSize,sort:this.sort,order:this.order}}).then(function(t){e.total=t.PlanCount,e.alarmPlans=t.PlanList}).always(function(){a?e.loading=!1:e.bgLoading=!1})},formatRecordDurantion:function(t,e,a){return"0"==a?"不录制视频":a},formatSnapInterval:function(t,e,a){return"0"==a?"不截取快照":a},sortChange:function(t){this.sort=t.prop,this.order="ascending"==t.order?"asc":"desc",this.getAlarmPlans()},formatName:function(t,e,a){return a||"-"},editAlarmPlan:function(t){this.$refs.alarmPlanEditDlg.show(t)},editChannel:function(t){this.alarmPlanChannelListDlgTitle="报警预案关联通道("+(t.Name||t.ID)+")",this.$refs.alarmPlanChannelListDlg.show(t.ID)},removeAlarmPlan:function(e){var a=this;this.$confirm("确认删除 "+(e.Name||e.ID),"提示",{lockScroll:!1}).then(function(){t.post("/api/v1/alarm/plan/remove",{ID:e.ID}).always(function(){a.getAlarmPlans()})}).catch(function(){})},download:function(){window.open("/api/v1/alarm/plan/export")},uploaded:function(){this.$message({type:"success",message:"上传成功！"}),this.getAlarmPlans(),this.$refs.uploadDlg.hide()},toggleEnable:function(e){t.post("/api/v1/alarm/plan/setenable",{ID:e.ID,Enable:!e.Enable}).then(function(){e.Enable=!e.Enable})}},beforeDestroy:function(){this.timer&&(clearInterval(this.timer),this.timer=0)},beforeRouteEnter:function(t,e,a){a(function(e){e.q=t.query.q||"",e.online=t.query.online||"",e.currentPage=parseInt(t.params.page)||1,e.ready()})},beforeRouteUpdate:function(t,e,a){var r=this;a(),this.$nextTick(function(){r.q=t.query.q||"",r.online=t.query.online||"",r.currentPage=parseInt(t.params.page)||1,r.alarmPlans=[],r.total=0,r.getAlarmPlans()})}}}).call(e,a("0iPh"))},lGU5:function(t,e,a){"use strict";var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"modal fade upload-dlg",attrs:{"data-backdrop":"static","data-keyboard":"true",tabindex:"-1"}},[a("div",{staticClass:"modal-dialog"},[a("div",{staticClass:"modal-content"},[a("div",{staticClass:"modal-header"},[t._m(0),t._v(" "),a("h4",{staticClass:"modal-title text-center text-info"},[a("span",[t._v(t._s(t.title))])])]),t._v(" "),a("div",{staticClass:"modal-body"},[t._t("header"),t._v(" "),a("el-upload",{ref:"uploader",attrs:{drag:t.drag,action:t.url,multiple:t.multiple,"show-file-list":t.showFileList,limit:1,"on-success":t.onSuccess,"on-progress":t.onProgress,"on-error":t.onError,"on-remove":t.onRemove,accept:t.accept,"before-upload":t.beforeUpload,"auto-upload":t.autoUpload}},[a("i",{staticClass:"el-icon-upload"}),t._v(" "),a("div",{staticClass:"el-upload__text"},[t._v("将配置数据拖到此处，或 "),a("em",[t._v("点击上传")])]),t._v(" "),a("div",{staticClass:"el-upload__tip text-center",attrs:{slot:"tip"},slot:"tip"},[t._v(t._s(t.tip)),a("span",{staticStyle:{color:"red"}},[t._v(" *上传成功会自动删除原有数据，请注意导出备份*")])])]),t._v(" "),t._t("footer")],2),t._v(" "),a("div",{staticClass:"modal-footer"},[a("button",{staticClass:"btn btn-default",attrs:{type:"button","data-dismiss":"modal",disabled:t.bProgress}},[t._v("关闭")])])])])])},n=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"modal","aria-label":"Close"}},[a("span",{attrs:{"aria-hidden":"true"}},[t._v("×")])])}],o={render:r,staticRenderFns:n};e.a=o},oZGG:function(t,e,a){e=t.exports=a("FZ+f")(!1),e.push([t.i,".opt-group .cell{overflow:visible}",""])},qb8i:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),a("F8S1");var r=a("0iPh"),n=function(t){return t&&t.__esModule?t:{default:t}}(r);e.default={props:{title:{default:"上传"},url:{type:String,default:""},multiple:{type:Boolean,default:!1},drag:{type:Boolean,default:!0},showFileList:{type:Boolean,default:!0},accept:{default:".xlsx"},tip:{default:"仅限上传.xlsx"},limit:{type:Number,default:0},autoUpload:{type:Boolean,default:!0}},data:function(){return{bShow:!1,bProgress:!1}},mounted:function(){var t=this;(0,n.default)(this.$el).find(".modal-content").draggable({handle:".modal-header",cancel:".modal-title span",addClasses:!1,containment:"document",delay:100,opacity:.5}),(0,n.default)(this.$el).on("shown.bs.modal",function(){t.$emit("show"),t.bShow=!0}).on("hidden.bs.modal",function(){t.$emit("hide"),t.bShow=!1,t.$refs.uploader.clearFiles()}).on("hide.bs.modal",function(){if(t.bProgress)return t.$message({type:"error",message:"正在上传, 请稍后..."}),!1})},methods:{show:function(){(0,n.default)(this.$el).modal("show")},hide:function(){(0,n.default)(this.$el).modal("hide")},beforeUpload:function(t){return!(this.limit&&t.size>this.limit)||(this.$message({type:"error",message:"文件["+t.name+"]大小超过限制["+this.limit+"], 不能上传!"}),!1)},onSuccess:function(t,e,a){var r=!0,n=!1,o=void 0;try{for(var i,s=a[Symbol.iterator]();!(r=(i=s.next()).done);r=!0){var l=i.value;if(100!=l.percentage&&0!==l.percentage)return void(this.bProgress=!0)}}catch(t){n=!0,o=t}finally{try{!r&&s.return&&s.return()}finally{if(n)throw o}}this.bProgress=!1,this.$emit("uploaded",e)},onProgress:function(t,e,a){this.bProgress=!0},onError:function(t,e,a){t&&this.$message({type:"error",message:t+""});var r=!0,n=!1,o=void 0;try{for(var i,s=a[Symbol.iterator]();!(r=(i=s.next()).done);r=!0){var l=i.value;if(100!=l.percentage&&0!==l.percentage)return void(this.bProgress=!0)}}catch(t){n=!0,o=t}finally{try{!r&&s.return&&s.return()}finally{if(n)throw o}}this.bProgress=!1},onRemove:function(t,e){var a=!0,r=!1,n=void 0;try{for(var o,i=e[Symbol.iterator]();!(a=(o=i.next()).done);a=!0){var s=o.value;if(100!=s.percentage&&0!==s.percentage)return void(this.bProgress=!0)}}catch(t){r=!0,n=t}finally{try{!a&&i.return&&i.return()}finally{if(r)throw n}}this.bProgress=!1}}}},qzZP:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=a("5Ggk"),n=a.n(r);for(var o in r)["default","default"].indexOf(o)<0&&function(t){a.d(e,t,function(){return r[t]})}(o);var i=a("AbGX"),s=a("VU/8"),l=s(n.a,i.a,!1,null,null,null);e.default=l.exports},rF1v:function(t,e,a){e=t.exports=a("FZ+f")(!1),e.push([t.i,".upload-dlg .modal-dialog .modal-body{overflow:hidden}.upload-dlg .modal-dialog .modal-body .el-upload{display:block}.upload-dlg .modal-dialog .modal-body .el-upload .el-upload-dragger{margin:0 auto}",""])},rgK0:function(t,e,a){"use strict";var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"box box-primary"},[t._m(0),t._v(" "),a("div",{staticClass:"box-body"},[a("div",{staticClass:"form-inline",attrs:{autocomplete:"off",spellcheck:"false"}},[a("div",{staticClass:"form-group"},["no"!=t.$getQueryString("menu")?a("button",{staticClass:"btn btn-primary btn-sm",attrs:{type:"button"},on:{click:function(e){e.preventDefault(),t.$router.go(-1)}}},[a("i",{staticClass:"fa fa-chevron-left"}),t._v(" 返回\n                    ")]):t._e()]),t._v(" "),a("span",{staticClass:"hidden-xs"},[t._v("  ")]),t._v(" "),a("div",{staticClass:"form-group form-group-sm"},[a("div",{staticClass:"input-group input-group-sm"},[a("button",{staticClass:"btn btn-sm btn-primary",attrs:{type:"button"},on:{click:function(e){e.preventDefault(),t.$refs.alarmPlanEditDlg.show()}}},[a("i",{staticClass:"fa fa-plus"}),t._v(" 添加报警预案\n                        ")])])]),t._v(" "),a("span",{staticClass:"hidden-xs"},[t._v("  ")]),t._v(" "),a("div",{staticClass:"form-group form-group-sm"},[a("label",[t._v("搜索")]),t._v(" "),!t.isMobile()&&t.hasAnyRole(t.serverInfo,t.userInfo,"超级管理员")?a("div",{staticClass:"input-group input-group-sm"},[a("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.q,expression:"q",modifiers:{trim:!0}}],ref:"q",staticClass:"form-control",attrs:{type:"text",placeholder:"关键字"},domProps:{value:t.q},on:{keydown:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;e.preventDefault()},input:function(e){e.target.composing||(t.q=e.target.value.trim())},blur:function(e){t.$forceUpdate()}}}),t._v(" "),a("div",{staticClass:"input-group-btn"},[a("button",{staticClass:"btn btn-sm btn-primary",attrs:{type:"button",title:"导出报警预案列表"},on:{click:function(e){e.preventDefault(),t.download(e)}}},[a("i",{staticClass:"fa fa-download"})]),t._v(" "),a("button",{staticClass:"btn btn-sm btn-primary",attrs:{type:"button",title:"导入报警预案列表"},on:{click:function(e){e.preventDefault(),t.$refs.uploadDlg.show()}}},[a("i",{staticClass:"fa fa-upload"})])])]):a("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.q,expression:"q",modifiers:{trim:!0}}],ref:"q",staticClass:"form-control",attrs:{type:"text",placeholder:"关键字"},domProps:{value:t.q},on:{keydown:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;e.preventDefault()},input:function(e){e.target.composing||(t.q=e.target.value.trim())},blur:function(e){t.$forceUpdate()}}})])]),t._v(" "),a("br"),t._v(" "),a("div",{staticClass:"clearfix"}),t._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{data:t.alarmPlans,stripe:"","default-sort":{prop:"CreatedAt",order:"descending"},"element-loading-text":"加载中..."},on:{"sort-change":t.sortChange}},[a("el-table-column",{attrs:{prop:"Name",label:"名称","min-width":"150","show-overflow-tooltip":"",sortable:"custom"}}),t._v(" "),a("el-table-column",{attrs:{label:"操作","min-width":"250",fixed:!t.isMobile()&&"right","class-name":"opt-group"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"btn-group btn-group-xs"},[a("button",{staticClass:"btn btn-warning",attrs:{type:"button"},on:{click:function(a){a.preventDefault(),t.editAlarmPlan(e.row)}}},[a("i",{staticClass:"fa fa-edit"}),t._v(" 编辑\n                            ")]),t._v(" "),a("button",{staticClass:"btn btn-primary",attrs:{type:"button"},on:{click:function(a){a.preventDefault(),t.editChannel(e.row)}}},[a("i",{staticClass:"fa fa-check"}),t._v(" 关联通道\n                            ")]),t._v(" "),a("button",{staticClass:"btn btn-danger",attrs:{type:"button"},on:{click:function(a){a.preventDefault(),t.removeAlarmPlan(e.row)}}},[a("i",{staticClass:"fa fa-remove"}),t._v(" 删除\n                            ")])])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"Enable",label:"是否启用","min-width":"100",sortable:"custom"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-switch",{attrs:{value:e.row.Enable},on:{change:function(a){t.toggleEnable(e.row)}}})]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"SnapInterval",label:"快照周期(秒)",formatter:t.formatSnapInterval,"min-width":"160","show-overflow-tooltip":"",sortable:"custom"}}),t._v(" "),"标准版"!=t.serverInfo.VersionType?a("el-table-column",{attrs:{prop:"RecordDuration",label:"录像时长(秒)",formatter:t.formatRecordDurantion,"min-width":"160","show-overflow-tooltip":"",sortable:"custom"}}):t._e(),t._v(" "),a("el-table-column",{attrs:{prop:"UpdatedAt",label:"更新时间","min-width":"160",sortable:"custom"}}),t._v(" "),a("el-table-column",{attrs:{prop:"CreatedAt",label:"创建时间","min-width":"160",sortable:"custom"}})],1)],1),t._v(" "),t.total>0?a("div",{staticClass:"box-footer"},[a("el-pagination",{staticClass:"pull-right",attrs:{layout:"total,prev,pager,next","pager-count":t.isMobile()?3:5,total:t.total,"page-size":t.pageSize,"current-page":t.currentPage},on:{"update:pageSize":function(e){t.pageSize=e},"update:currentPage":function(e){t.currentPage=e}}})],1):t._e()]),t._v(" "),a("UploadDlg",{ref:"uploadDlg",attrs:{title:"上传报警预案列表",url:"/api/v1/alarm/plan/import"},on:{uploaded:t.uploaded}}),t._v(" "),a("AlarmPlanEditDlg",{ref:"alarmPlanEditDlg",attrs:{serverInfo:t.serverInfo,userInfo:t.userInfo},on:{submit:function(e){t.getAlarmPlans()}}}),t._v(" "),a("AlarmPlanChannelListDlg",{ref:"alarmPlanChannelListDlg",attrs:{serverInfo:t.serverInfo,userInfo:t.userInfo,title:t.alarmPlanChannelListDlgTitle}})],1)},n=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"box-header"},[a("h4",{staticClass:"text-primary text-center"},[t._v("报警预案列表")])])}],o={render:r,staticRenderFns:n};e.a=o},"u/lO":function(t,e,a){"use strict";var r=function(){var t=this,e=t.$createElement;return(t._self._c||e)("input",{attrs:{type:"text",placeholder:t.placeholder}})},n=[],o={render:r,staticRenderFns:n};e.a=o},uaBg:function(t,e,a){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),a("F8S1");var n=a("0iPh"),o=r(n),i=a("M4fF"),s=r(i);e.default={props:{title:{default:""},size:{type:String,default:"modal-lgg"},fade:{type:Boolean,default:!1},serverInfo:{type:Object,default:function(){}},userInfo:{type:Object,default:function(){return null}}},data:function(){return{q:"",subscribed:"",online:"",total:0,relateCnt:0,pageSize:10,currentPage:1,sort:"",order:"",related:!1,reverse:!1,loading:!1,channels:[],globalDeviceAlarmSubscribeInterval:0,selection:[],id:""}},watch:{q:function(t,e){this.doDelaySearch()},related:function(t,e){this.doSearch()},reverse:function(t,e){this.doSearch()},online:function(t,e){this.doSearch()},subscribed:function(t,e){this.doSearch()},currentPage:function(t,e){this.doSearch(t)},pageSize:function(t,e){this.doSearch()}},mounted:function(){var t=this;(0,o.default)(this.$el).find(".modal-content").draggable({handle:".modal-header",cancel:".modal-title span",addClasses:!1,containment:"document",delay:100,opacity:.5}),(0,o.default)(this.$el).on("shown.bs.modal",function(){t.$emit("show")}).on("hidden.bs.modal",function(){t.errors.clear(),t.reset(),t.$emit("hide")})},directives:{focus:{inserted:function(t){t.focus(),t.select()}}},methods:{sortChange:function(t){this.sort=t.prop,this.order="ascending"==t.order?"asc":"desc",this.getChannels()},select:function(t,e){var a=this;t.indexOf(e)>=0?o.default.post("/api/v1/alarm/plan/savechannels",{id:this.id,channels:[e.DeviceID+":"+e.ID]}).always(function(){a.getChannels()}):o.default.post("/api/v1/alarm/plan/removechannels",{id:this.id,channels:[e.DeviceID+":"+e.ID]}).always(function(){a.getChannels()})},selectAll:function(t){var e=this,a=[];if(t.length){var r=!0,n=!1,i=void 0;try{for(var s,l=t[Symbol.iterator]();!(r=(s=l.next()).done);r=!0){var c=s.value;this.selection.indexOf(c)<0&&a.push(c.DeviceID+":"+c.ID)}}catch(t){n=!0,i=t}finally{try{!r&&l.return&&l.return()}finally{if(n)throw i}}o.default.post("/api/v1/alarm/plan/savechannels",{id:this.id,channels:a}).always(function(){e.getChannels()})}else{var u=!0,d=!1,f=void 0;try{for(var m,p=this.selection[Symbol.iterator]();!(u=(m=p.next()).done);u=!0){var c=m.value;a.push(c.DeviceID+":"+c.ID)}}catch(t){d=!0,f=t}finally{try{!u&&p.return&&p.return()}finally{if(d)throw f}}o.default.post("/api/v1/alarm/plan/removechannels",{id:this.id,channels:a}).always(function(){e.getChannels()})}},doSearch:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.currentPage=t,this.getChannels()},doDelaySearch:s.default.debounce(function(){this.doSearch()},800),formatName:function(t,e,a){var r=t.DeviceCustomName||t.DeviceName||"",n=t.CustomName||t.Name||"";return r&&r!=n&&(n=n?n+"@"+r:r),n||"-"},formatDeviceName:function(t,e,a){return t.DeviceCustomName||t.DeviceName||"-"},formatChannelName:function(t,e,a){return t.CustomName||t.Name||"-"},formatManufacturer:function(t,e,a){return a||"-"},formatAlarmSubscribe:function(t,e,a){return t.SubscribeInterval<0?"未订阅":0==t.SubscribeInterval?this.globalDeviceAlarmSubscribeInterval<=0?"未订阅":"已全局订阅":t.SubscribeInterval>0&&!t.AlarmSubscribe?"未订阅":"已订阅"},selectable:function(t,e){return!0},getChannels:function(){var t=this;this.id&&(this.loading=!0,o.default.get("/api/v1/alarm/plan/channellist",{id:this.id,q:this.q,subscribed:this.subscribed,online:this.online,start:(this.currentPage-1)*this.pageSize,limit:this.pageSize,related:this.related,reverse:this.reverse,sort:this.sort,order:this.order}).then(function(e){t.$refs.channelTable.clearSelection(),t.globalDeviceAlarmSubscribeInterval=e.GlobalDeviceAlarmSubscribeInterval||0,t.total=e.ChannelCount,t.relateCnt=e.ChannelRelateCount,t.channels=e.ChannelList||[],t.selection=[],t.$nextTick(function(){t.channels.forEach(function(e){var a=""!=e.PlanID;t.$refs.channelTable.toggleRowSelection(e,a),a&&t.selection.push(e)})})}).always(function(){t.$nextTick(function(){t.loading=!1})}))},isDir:function(t){if(t){if(t.SubCount>0)return!0;if(this.serverInfo.StrictChannelParental&&1==t.Parental)return!0;if(this.serverInfo.StrictChannelCode&&t.ID.length<=10)return!0;if(1==t.Parental&&"LiveQing"==t.Manufacturer)return!0;if(20==t.ID.length&&("216"==t.ID.substring(10,13)||"215"==t.ID.substring(10,13)))return!0}return!1},reset:function(){this.id="",this.$refs.channelTable.clearSelection(),this.channels=[],this.selection=[],this.q="",this.subscribed="",this.online="",this.related=!1,this.reverse=!1,this.total=0,this.relateCnt=0,this.currentPage=1,this.pageSize=10},show:function(t){this.id=t,(0,o.default)(this.$el).modal("show"),this.getChannels()},hide:function(){(0,o.default)(this.$el).modal("hide")},toggleReverse:function(){this.reverse=!this.reverse}}}},"yW/O":function(t,e,a){"use strict";function r(t){a("Of5B")}Object.defineProperty(e,"__esModule",{value:!0});var n=a("iFpf"),o=a.n(n);for(var i in n)["default","default"].indexOf(i)<0&&function(t){a.d(e,t,function(){return n[t]})}(i);var s=a("2vSs"),l=a("VU/8"),c=r,u=l(o.a,s.a,!1,c,"data-v-c396325e",null);e.default=u.exports}});