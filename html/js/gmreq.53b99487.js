webpackJsonp([12],{"1aM5":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r("Cegs"),n=r.n(o);for(var a in o)["default","default"].indexOf(a)<0&&function(e){r.d(t,e,function(){return o[e]})}(a);var i=r("OUeX"),s=r("VU/8"),l=s(n.a,i.a,!1,null,null,null);t.default=l.exports},"9n6n":function(e,t,r){"use strict";var o=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("FormDlg",{ref:"dlg",attrs:{title:"签发国密证书",disabled:e.errors.any()},on:{hide:e.onHide,show:e.onShow,submit:e.onSubmit}},[r("div",{directives:[{name:"show",rawName:"v-show",value:e.common_name,expression:"common_name"}],class:{"form-group":!0,"has-feedback":!0,"has-error":e.errors.has("common_name")}},[r("label",{staticClass:"col-sm-4 control-label"},[e._v("签发给")]),e._v(" "),r("div",{staticClass:"col-sm-7"},[r("input",{staticClass:"form-control",attrs:{type:"text",name:"common_name",readonly:""},domProps:{value:e.common_name}})])]),e._v(" "),r("div",{class:{"form-group":!0,"has-feedback":!0,"has-error":e.errors.has("valid_days")}},[r("label",{staticClass:"col-sm-4 control-label"},[e._v("有效期(天)\n            "),r("span",{staticClass:"text-red"},[e._v("*")])]),e._v(" "),r("div",{staticClass:"col-sm-7"},[r("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.form.valid_days,expression:"form.valid_days",modifiers:{trim:!0}},{name:"validate",rawName:"v-validate",value:"required|numeric|min_value:1",expression:"'required|numeric|min_value:1'"}],staticClass:"form-control",attrs:{type:"text",name:"valid_days","data-vv-as":"有效期"},domProps:{value:e.form.valid_days},on:{keydown:function(t){if(!("button"in t)&&e._k(t.keyCode,"enter",13,t.key))return null;t.preventDefault(),e.onSubmit(t)},input:function(t){t.target.composing||e.$set(e.form,"valid_days",t.target.value.trim())},blur:function(t){e.$forceUpdate()}}})])])])},n=[],a={render:o,staticRenderFns:n};t.a=a},Caqn:function(e,t,r){"use strict";(function(e){function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}return e},a=r("SKKk"),i=o(a),s=r("1aM5"),l=o(s),u=r("M4fF"),c=o(u),m=r("NYxO");t.default={props:{},data:function(){return{q:"",total:0,pageSize:10,currentPage:1,sort:"CreatedAt",order:"desc",loading:!1,bUploading:!1,reqList:[]}},components:{GmReqSignDlg:i.default,GmReqRemarkDlg:l.default},computed:n({},(0,m.mapState)(["userInfo","serverInfo"])),mounted:function(){},beforeDestroy:function(){},methods:{ready:function(){this.$watch("q",function(e,t){this.doDelaySearch()}),this.$watch("currentPage",function(e,t){this.doSearch(e)})},doSearch:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t={};this.q&&(t.q=this.q),this.$router.replace({path:"/gm/req/"+e,query:t})},doDelaySearch:c.default.debounce(function(){this.doSearch()},800),getReqList:function(){var t=this;this.loading=!0,e.get("/api/v1/gm/req/list",{q:this.q,start:(this.currentPage-1)*this.pageSize,limit:this.pageSize,sort:this.sort,order:this.order}).then(function(e){t.total=e.GMReqCount,t.reqList=e.GMReqList}).always(function(){t.$nextTick(function(){t.loading=!1})})},sortChange:function(e){this.sort=e.prop,this.order="ascending"==e.order?"asc":"desc",this.getReqList()},formatCell:function(e,t,r){return e[t.property]||"-"},formatCommonName:function(e,t,r){var o=r||"-",n=o.split("_");return 2==n.length&&(o=n[0]||"-"),o},removeReq:function(t,r){var o=this;this.$confirm("确认删除 "+(t.Serial||this.formatCommonName(t,r,t.CommonName))+" ?","提示",{lockScroll:!1}).then(function(){e.post("/api/v1/gm/req/remove",{id:t.ID}).always(function(){o.getReqList()})}).catch(function(){})},signReq:function(e,t){this.$refs.signDlg.show(e.ID,this.formatCommonName(e,t,e.CommonName))},remarkReq:function(e,t){this.$refs.remarkDlg.show({id:e.ID,serial:e.Serial||"-",common_name:this.formatCommonName(e,t,e.CommonName),description:e.Description})},onUploadReqCertSuccess:function(e,t,r){this.bUploading=!1,this.getReqList(),this.$message({type:"success",message:"上传证书请求成功！"})},onUploadReqCertProgress:function(e,t,r){this.bUploading=!0},onUploadReqCertError:function(e,t,r){this.bUploading=!1,e&&this.$message({type:"error",message:e+""})}},beforeRouteEnter:function(e,t,r){r(function(t){t.q=e.query.q||"",t.currentPage=parseInt(e.params.page)||1,t.ready()})},beforeRouteLeave:function(e,t,r){r()},beforeRouteUpdate:function(e,t,r){var o=this;r(),this.$nextTick(function(){o.q=e.query.q||"",o.currentPage=parseInt(e.params.page)||1,o.reqList=[],o.total=0,o.getReqList()})}}}).call(t,r("0iPh"))},Cegs:function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function n(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function o(n,a){try{var i=t[n](a),s=i.value}catch(e){return void r(e)}if(!i.done)return Promise.resolve(s).then(function(e){o("next",e)},function(e){o("throw",e)});e(s)}return o("next")})}}Object.defineProperty(t,"__esModule",{value:!0});var a=r("A9K1"),i=o(a),s=r("0iPh"),l=o(s);t.default={data:function(){return{form:this.defForm()}},components:{FormDlg:i.default},methods:{defForm:function(){return{id:"",serial:"",common_name:"",description:""}},onHide:function(){this.form=this.defForm(),this.$emit("hide")},onShow:function(){this.errors.clear(),this.$emit("show"),this.$el.querySelector("#input-description").focus()},onSubmit:function(){var e=this;return n(regeneratorRuntime.mark(function t(){var r,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$validator.validateAll();case 2:if(r=t.sent){t.next=8;break}return o=e.errors.items[0],e.$message({type:"error",message:o.msg}),(0,l.default)("[name="+o.field+"]").focus(),t.abrupt("return");case 8:l.default.post("/api/v1/gm/req/setdescription",{id:e.form.id,description:e.form.description}).then(function(t){e.$refs.dlg.hide(),e.$emit("submit")});case 9:case"end":return t.stop()}},t,e)}))()},show:function(e){var t=this;this.errors.clear(),e&&(this.form.id=e.id,this.form.serial=e.serial,this.form.common_name=e.common_name,this.form.description=e.description),this.$nextTick(function(){t.$refs.dlg.show()})}}}},FY12:function(e,t,r){"use strict";var o=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("div",{staticClass:"box box-primary"},[e._m(0),e._v(" "),r("div",{staticClass:"box-body"},[r("div",{staticClass:"form-inline",attrs:{autocomplete:"off",spellcheck:"false"}},[r("div",{staticClass:"form-group form-group-sm"},[r("div",{staticClass:"input-group input-group-sm"},[r("el-upload",{staticStyle:{display:"inline-block","margin-right":"7px"},attrs:{action:"/api/v1/gm/req/import","show-file-list":!1,"on-success":e.onUploadReqCertSuccess,"on-error":e.onUploadReqCertError,"on-progress":e.onUploadReqCertProgress}},[r("button",{staticClass:"btn btn-sm btn-primary",attrs:{type:"button",title:"上传证书请求"}},[r("i",{staticClass:"fa fa-upload"}),e._v(" 上传证书请求")])])],1)]),e._v(" "),r("span",{staticClass:"hidden-xs"},[e._v("  ")]),e._v(" "),r("div",{staticClass:"form-group form-group-sm"},[r("label",[e._v("搜索")]),e._v(" "),r("input",{directives:[{name:"model",rawName:"v-model.trim",value:e.q,expression:"q",modifiers:{trim:!0}}],ref:"q",staticClass:"form-control",attrs:{type:"text",placeholder:"关键字"},domProps:{value:e.q},on:{keydown:function(t){if(!("button"in t)&&e._k(t.keyCode,"enter",13,t.key))return null;t.preventDefault()},input:function(t){t.target.composing||(e.q=t.target.value.trim())},blur:function(t){e.$forceUpdate()}}})])]),e._v(" "),r("br"),e._v(" "),r("div",{staticClass:"clearfix"}),e._v(" "),r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{data:e.reqList,stripe:"","default-sort":{prop:"CreatedAt",order:"descending"},"element-loading-text":"加载中..."},on:{"sort-change":e.sortChange}},[r("el-table-column",{attrs:{prop:"Serial",label:"序列号","min-width":"280","show-overflow-tooltip":"",sortable:"custom",formatter:e.formatCell}}),e._v(" "),r("el-table-column",{attrs:{label:"操作","min-width":"150",fixed:!e.isMobile()&&"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("div",{staticClass:"btn-group btn-group-xs"},[e.userInfo?r("button",{staticClass:"btn btn-primary",attrs:{type:"button"},on:{click:function(r){r.preventDefault(),e.signReq(t.row,t.column)}}},[r("i",{staticClass:"fa fa-download"}),e._v(" 签发证书\r\n                            ")]):e._e(),e._v(" "),e.userInfo?r("button",{staticClass:"btn btn-danger",attrs:{type:"button"},on:{click:function(r){r.preventDefault(),e.removeReq(t.row,t.column)}}},[r("i",{staticClass:"fa fa-remove"}),e._v(" 删除\r\n                            ")]):e._e()])]}}])}),e._v(" "),r("el-table-column",{attrs:{prop:"CommonName",label:"签发给","min-width":"200","show-overflow-tooltip":"",sortable:"custom",formatter:e.formatCommonName}}),e._v(" "),r("el-table-column",{attrs:{prop:"Description",label:"备注","min-width":"200","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[r("a",{attrs:{role:"button",title:"编辑备注"},on:{click:function(r){r.preventDefault(),e.remarkReq(t.row,t.column)}}},[r("i",{staticClass:"fa fa-edit"})]),e._v("\r\n                        "+e._s(t.row.Description||"-")+"\r\n                    ")]}}])}),e._v(" "),r("el-table-column",{attrs:{prop:"CreatedAt",label:"创建时间","min-width":"160",sortable:"custom"}})],1)],1),e._v(" "),e.total>0?r("div",{staticClass:"box-footer"},[r("el-pagination",{staticClass:"pull-right",attrs:{layout:"total,prev,pager,next","pager-count":e.isMobile()?3:5,total:e.total,"page-size":e.pageSize,"current-page":e.currentPage},on:{"update:pageSize":function(t){e.pageSize=t},"update:currentPage":function(t){e.currentPage=t}}})],1):e._e(),e._v(" "),r("GmReqSignDlg",{ref:"signDlg"}),e._v(" "),r("GmReqRemarkDlg",{ref:"remarkDlg",on:{submit:e.getReqList}})],1)])},n=[function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"box-header"},[r("h4",{staticClass:"text-primary text-center"},[e._v("证书请求列表")])])}],a={render:o,staticRenderFns:n};t.a=a},Fv6z:function(e,t,r){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function n(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,r){function o(n,a){try{var i=t[n](a),s=i.value}catch(e){return void r(e)}if(!i.done)return Promise.resolve(s).then(function(e){o("next",e)},function(e){o("throw",e)});e(s)}return o("next")})}}Object.defineProperty(t,"__esModule",{value:!0});var a=r("A9K1"),i=o(a),s=r("0iPh"),l=o(s);t.default={data:function(){return{common_name:"",form:this.defForm()}},components:{FormDlg:i.default},methods:{defForm:function(){return{id:"",valid_days:3650}},onHide:function(){this.common_name="",this.form=this.defForm()},onShow:function(){this.errors.clear()},onSubmit:function(){var e=this;return n(regeneratorRuntime.mark(function t(){var r,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$validator.validateAll();case 2:if(r=t.sent){t.next=8;break}return o=e.errors.items[0],e.$message({type:"error",message:o.msg}),(0,l.default)("[name="+o.field+"]").focus(),t.abrupt("return");case 8:window.open("/api/v1/gm/req/sign?id="+e.form.id+"&valid_days="+e.form.valid_days,"_blank"),e.$refs.dlg.hide(),e.$emit("submit");case 11:case"end":return t.stop()}},t,e)}))()},show:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";this.errors.clear(),this.common_name=t||"",this.form.id=e||"",this.$refs.dlg.show()}}}},OUeX:function(e,t,r){"use strict";var o=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("FormDlg",{ref:"dlg",attrs:{title:"备注证书请求",disabled:e.errors.any()},on:{hide:e.onHide,show:e.onShow,submit:e.onSubmit}},[r("div",{class:{"form-group":!0,"has-error":e.errors.has("serial")}},[r("label",{staticClass:"col-sm-4 control-label",attrs:{for:"input-serial"}},[e._v("序列号\n            ")]),e._v(" "),r("div",{staticClass:"col-sm-7"},[r("input",{staticClass:"form-control",attrs:{type:"text",readonly:"readonly",id:"input-serial",name:"serial","data-vv-as":"序列号"},domProps:{value:e.form.serial}})])]),e._v(" "),r("div",{class:{"form-group":!0,"has-error":e.errors.has("common_name")}},[r("label",{staticClass:"col-sm-4 control-label",attrs:{for:"input-common-name"}},[e._v("签发给\n            ")]),e._v(" "),r("div",{staticClass:"col-sm-7"},[r("input",{staticClass:"form-control",attrs:{type:"text",readonly:"readonly",id:"input-common-name",name:"common_name","data-vv-as":"签发给"},domProps:{value:e.form.common_name}})])]),e._v(" "),r("div",{class:{"form-group":!0,"has-error":e.errors.has("description")}},[r("label",{staticClass:"col-sm-4 control-label",attrs:{for:"input-description"}},[e._v("备注\n        ")]),e._v(" "),r("div",{staticClass:"col-sm-7"},[r("el-input",{attrs:{id:"input-description",type:"textarea",autosize:{minRows:3,maxRows:10},rows:3,placeholder:"可选"},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description","string"==typeof t?t.trim():t)},expression:"form.description"}})],1)])])},n=[],a={render:o,staticRenderFns:n};t.a=a},SKKk:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r("Fv6z"),n=r.n(o);for(var a in o)["default","default"].indexOf(a)<0&&function(e){r.d(t,e,function(){return o[e]})}(a);var i=r("9n6n"),s=r("VU/8"),l=s(n.a,i.a,!1,null,null,null);t.default=l.exports},"kCP/":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=r("Caqn"),n=r.n(o);for(var a in o)["default","default"].indexOf(a)<0&&function(e){r.d(t,e,function(){return o[e]})}(a);var i=r("FY12"),s=r("VU/8"),l=s(n.a,i.a,!1,null,null,null);t.default=l.exports}});