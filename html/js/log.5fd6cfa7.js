webpackJsonp([11],{"2X2r":function(t,e,a){"use strict";var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("div",{staticClass:"box box-primary"},[t._m(0),t._v(" "),a("div",{staticClass:"box-body"},[a("div",{staticClass:"form-inline",attrs:{autocomplete:"off",spellcheck:"false"}},[a("div",{staticClass:"form-group form-group-sm"},[a("label",[t._v("搜索")]),t._v(" "),!t.isMobile()&&t.hasAnyRole(t.serverInfo,t.userInfo,"超级管理员")?a("div",{staticClass:"input-group input-group-sm"},[a("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.q,expression:"q",modifiers:{trim:!0}}],ref:"q",staticClass:"form-control",attrs:{type:"text",placeholder:"关键字"},domProps:{value:t.q},on:{keydown:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;e.preventDefault()},input:function(e){e.target.composing||(t.q=e.target.value.trim())},blur:function(e){t.$forceUpdate()}}}),t._v(" "),a("div",{staticClass:"input-group-btn"},[a("button",{staticClass:"btn btn-sm btn-primary",attrs:{type:"button",title:"导出日志列表"},on:{click:function(e){e.preventDefault(),t.$refs.logExportDlg.show()}}},[a("i",{staticClass:"fa fa-download"})])])]):a("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.q,expression:"q",modifiers:{trim:!0}}],ref:"q",staticClass:"form-control",attrs:{type:"text",placeholder:"关键字"},domProps:{value:t.q},on:{keydown:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key))return null;e.preventDefault()},input:function(e){e.target.composing||(t.q=e.target.value.trim())},blur:function(e){t.$forceUpdate()}}})]),t._v(" "),a("span",{staticClass:"hidden-xs"},[t._v("  ")]),t._v(" "),a("div",{staticClass:"form-group form-group-sm"},[a("label",[t._v("调用方式")]),t._v(" "),a("select",{directives:[{name:"model",rawName:"v-model.trim",value:t.method,expression:"method",modifiers:{trim:!0}}],staticClass:"form-control",on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,function(t){return t.selected}).map(function(t){return"_value"in t?t._value:t.value});t.method=e.target.multiple?a:a[0]}}},[a("option",{attrs:{value:""}},[t._v("全部")]),t._v(" "),a("option",{attrs:{value:"GET"}},[t._v("HTTP GET")]),t._v(" "),a("option",{attrs:{value:"POST"}},[t._v("HTTP POST")]),t._v(" "),a("option",{attrs:{value:"MESSAGE"}},[t._v("SIP MESSAGE")]),t._v(" "),a("option",{attrs:{value:"SUBSCRIBE"}},[t._v("SIP SUBSCRIBE")]),t._v(" "),a("option",{attrs:{value:"INFO"}},[t._v("SIP INFO")]),t._v(" "),a("option",{attrs:{value:"INVITE"}},[t._v("SIP INVITE")]),t._v(" "),a("option",{attrs:{value:"BYE"}},[t._v("SIP BYE")])])]),t._v(" "),a("span",{staticClass:"hidden-xs"},[t._v("  ")]),t._v(" "),a("div",{staticClass:"form-group"},[a("div",{staticClass:"input-group input-group-sm"},[a("DatePicker",{ref:"startDatePicker",staticClass:"form-control input-group-sm",attrs:{clearBtn:"",day:t.starttime,placeholder:"开始日期"},on:{"update:day":function(e){t.starttime=e}}}),t._v(" "),a("div",{staticClass:"input-group-btn"},[a("button",{staticClass:"btn btn-sm btn-default",attrs:{type:"button"},on:{click:function(e){e.preventDefault(),t.showStartDatePicker(e)}}},[a("i",{staticClass:"fa fa-calendar"})])])],1)]),t._v(" "),a("span",{staticClass:"hidden-xs"},[t._v(" - ")]),t._v(" "),a("div",{staticClass:"form-group"},[a("div",{staticClass:"input-group input-group-sm"},[a("DatePicker",{ref:"endDatePicker",staticClass:"form-control input-group-sm",attrs:{clearBtn:"",day:t.endtime,placeholder:"结束日期"},on:{"update:day":function(e){t.endtime=e}}}),t._v(" "),a("div",{staticClass:"input-group-btn"},[a("button",{staticClass:"btn btn-sm btn-default",attrs:{type:"button"},on:{click:function(e){e.preventDefault(),t.showEndDatePicker(e)}}},[a("i",{staticClass:"fa fa-calendar"})])])],1)]),t._v(" "),t.hasAnyRole(t.serverInfo,t.userInfo,"超级管理员")&&t.hasAllChannel(t.serverInfo,t.userInfo)?a("div",{staticClass:"form-group form-group-sm pull-right"},[a("div",{staticClass:"input-group input-group-sm"},[a("button",{staticClass:"btn btn-sm btn-danger",attrs:{type:"button"},on:{click:function(e){e.preventDefault(),t.clearLog(e)}}},[a("i",{staticClass:"fa fa-remove"}),t._v(" 清空\n                            ")])])]):t._e()]),t._v(" "),a("br"),t._v(" "),a("div",{staticClass:"clearfix"}),t._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{data:t.logs,stripe:"","default-sort":{prop:"StartAt",order:"descending"},"element-loading-text":"加载中..."},on:{"sort-change":t.sortChange}},[a("el-table-column",{attrs:{prop:"Name",label:"操作名称","min-width":"140","show-overflow-tooltip":"",fixed:!t.isMobile()}}),t._v(" "),a("el-table-column",{attrs:{prop:"Method",label:"调用方式","min-width":"140",formatter:t.formatMethod}}),t._v(" "),a("el-table-column",{attrs:{prop:"RequestURI",label:"资源路径","min-width":"200","show-overflow-tooltip":""},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.ExtInfo||e.row.Description?a("a",{attrs:{role:"button"},on:{click:function(a){a.preventDefault(),t.alertExtInfo(e.row)}}},[t._v(t._s(e.row.RequestURI))]):a("span",[t._v(t._s(e.row.RequestURI))])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"RemoteAddr",label:"远端地址","min-width":"150","show-overflow-tooltip":""}}),t._v(" "),t.region?a("el-table-column",{attrs:{prop:"RemoteRegion",label:"所在地区","min-width":"150","show-overflow-tooltip":""}}):t._e(),t._v(" "),a("el-table-column",{attrs:{prop:"Status",label:"结果","min-width":"140",formatter:t.formatStatus,"show-overflow-tooltip":""}}),t._v(" "),a("el-table-column",{attrs:{prop:"Duration",label:"用时(秒)","min-width":"100",formatter:t.formatDuration,sortable:"custom","show-overflow-tooltip":""}}),t._v(" "),a("el-table-column",{attrs:{prop:"Username",label:"操作人","min-width":"140","show-overflow-tooltip":"",fixed:!t.isMobile()&&"right"}}),t._v(" "),a("el-table-column",{attrs:{prop:"StartAt",label:"操作时间","min-width":"160",sortable:"custom",fixed:!t.isMobile()&&"right"}})],1)],1),t._v(" "),t.total>0?a("div",{staticClass:"box-footer"},[a("el-pagination",{staticClass:"pull-right",attrs:{layout:"total,prev,pager,next","pager-count":t.isMobile()?3:5,total:t.total,"page-size":t.pageSize,"current-page":t.currentPage},on:{"update:pageSize":function(e){t.pageSize=e},"update:currentPage":function(e){t.currentPage=e}}})],1):t._e()]),t._v(" "),a("LogExportDlg",{ref:"logExportDlg",on:{submit:t.exportLogs}})],1)},o=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"box-header"},[a("h4",{staticClass:"text-primary text-center"},[t._v("日志列表")])])}],i={render:r,staticRenderFns:o};e.a=i},"49HP":function(t,e,a){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});var r=a("PJh5"),o=function(t){return t&&t.__esModule?t:{default:t}}(r);e.default={data:function(){return{flags:{},defaultFlags:"0000000000000000000000000000000"}},props:{placeholder:{default:"选择日期"},clearBtn:{type:Boolean,default:!1},day:{default:""}},mounted:function(){var e=this;t(this.$el).datepicker({language:"zh-CN",autoclose:!0,clearBtn:this.clearBtn,format:"yyyy-mm-dd",todayHighlight:!0}).on("changeDate",function(t){t.date?e.$emit("update:day",(0,o.default)(t.date).format("YYYYMMDD")):e.$emit("update:day","")}).on("change",function(){e.$el.value||e.$emit("update:day","")}),this.day&&t(this.$el).datepicker("setDate",(0,o.default)(this.day,"YYYYMMDD").toDate()),this.update()},watch:{day:function(e){if(e){var a=t(this.$el).datepicker("getDate");e!=(0,o.default)(a).format("YYYYMMDD")&&t(this.$el).datepicker("setDate",(0,o.default)(e,"YYYYMMDD").toDate())}}},computed:{},methods:{update:function(){t(this.$el).datepicker("update")}}}}).call(e,a("0iPh"))},G5yr:function(t,e,a){e=t.exports=a("FZ+f")(!1),e.push([t.i,".datepicker{z-index:9999!important}",""])},"I/0/":function(t,e,a){"use strict";(function(t){function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var a=arguments[e];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(t[r]=a[r])}return t},i=a("M4fF"),n=r(i),s=a("PJh5"),l=r(s),u=a("WEd6"),c=r(u),d=a("XwT2"),f=r(d),m=a("NYxO"),p=[];e.default={data:function(){return{q:"",method:"",starttime:"",endtime:"",total:0,pageSize:10,currentPage:1,sort:"StartAt",order:"desc",loading:!1,region:!1,timer:0,logs:[]}},computed:o({},(0,m.mapState)(["userInfo","serverInfo"])),components:{DatePicker:c.default,LogExportDlg:f.default},mounted:function(){},beforeDestroy:function(){this.timer&&(clearInterval(this.timer),this.timer=0)},methods:{ready:function(){p.push(this.$watch("q",function(t,e){this.doDelaySearch()})),p.push(this.$watch("starttime",function(t,e){this.doSearch()})),p.push(this.$watch("endtime",function(t,e){this.doSearch()})),p.push(this.$watch("method",function(t,e){this.doSearch()})),p.push(this.$watch("currentPage",function(t,e){this.doSearch(t)}))},doSearch:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e={};this.q&&(e.q=this.q),this.starttime&&(e.starttime=this.starttime),this.endtime&&(e.endtime=this.endtime),this.method&&(e.method=this.method),this.$router.replace({path:"/logs/"+t,query:e})},doDelaySearch:n.default.debounce(function(){this.doSearch()},800),getLogs:function(){var e=this,a=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];a&&(this.loading=!0),t.ajax({method:"GET",url:"/api/v1/log/list",global:a,data:{q:this.q,start:(this.currentPage-1)*this.pageSize,limit:this.pageSize,starttime:this.starttime?(0,l.default)(this.starttime,"YYYYMMDD").startOf("day").format("YYYYMMDDHHmmss"):"",endtime:this.endtime?(0,l.default)(this.endtime,"YYYYMMDD").endOf("day").format("YYYYMMDDHHmmss"):"",method:this.method,sort:this.sort,order:this.order}}).then(function(t){e.total=t.LogCount,e.logs=t.LogList,e.region=!!t.LogRegion}).always(function(){a&&e.$nextTick(function(){e.loading=!1})})},exportLogs:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e4,r={start:e,limit:a,sort:this.sort,order:this.order};t&&(r=Object.assign(r,{q:this.q,starttime:this.starttime?(0,l.default)(this.starttime,"YYYYMMDD").startOf("day").format("YYYYMMDDHHmmss"):"",endtime:this.endtime?(0,l.default)(this.endtime,"YYYYMMDD").endOf("day").format("YYYYMMDDHHmmss"):"",method:this.method}));var o=Object.keys(r).map(function(t){return encodeURIComponent(t)+"="+encodeURIComponent(r[t])}).join("&");window.open("/api/v1/log/export?"+o,"_blank")},sortChange:function(t){this.sort=t.prop,this.order="ascending"==t.order?"asc":"desc",this.getLogs()},formatMethod:function(t,e,a){return t.Scheme+" "+t.Method},formatStatus:function(t,e,a){return t.StatusCode+" "+t.Status},formatDuration:function(t,e,a){return l.default.duration(t.Duration).asSeconds()},showStartDatePicker:function(){t(this.$refs.startDatePicker.$el).focus()},showEndDatePicker:function(){t(this.$refs.endDatePicker.$el).focus()},removeLog:function(e){var a=this;this.$confirm("确认删除","提示",{lockScroll:!1}).then(function(){t.post("/api/v1/log/remove",{id:e.ID}).always(function(){a.getLogs()})}).catch(function(){})},clearLog:function(){var e=this;this.$confirm("确认全部删除","提示",{lockScroll:!1}).then(function(){t.post("/api/v1/log/clear",{}).then(function(){e.getLogs()})}).catch(function(){})},alertExtInfo:function(t){var e="";if("SIP"==t.Scheme&&t.ExtInfo?e=t.ExtInfo!=this.q&&"Call-ID:"+t.ExtInfo!=this.q?"Call-ID: <a href='#/logs/1?q="+encodeURIComponent("Call-ID:")+encodeURIComponent(t.ExtInfo)+"'>"+this.escapeHtml(t.ExtInfo)+"</a>":this.escapeHtml("Call-ID: "+t.ExtInfo):"HTTP"==t.Scheme&&"POST"==t.Method&&(e="POST "+this.escapeHtml(t.RequestURI)),t.Description){if("SIP"==t.Scheme&&"INVITE"==t.Method){var a=t.Description.match(/^t=(\d+)\s+(\d+)/m);if(a&&3==a.length){var r=parseInt(a[1])||0,o=parseInt(a[2])||0;r&&o&&(e&&(e+="\r\n"),e+="Time-Range: "+l.default.unix(r).format("YYYY-MM-DD HH:mm:ss")+" ~ "+l.default.unix(o).format("YYYY-MM-DD HH:mm:ss"))}}e&&(e+="\r\n\r\n"),e+=""+this.escapeHtml(t.Description)}this.$alert(e.replace(/\r?\n/g,"<br>"),t.Name||"提示",{lockScroll:!1,showConfirmButton:!1,dangerouslyUseHTMLString:!0,closeOnClickModal:!1,closeOnPressEscape:!0,customClass:"break-word"}).catch(function(){})},escapeHtml:function(t){return t.replace(/&/g,"&amp;").replace(/ /g,"&nbsp;").replace(/\t/g,"&nbsp;&nbsp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}},beforeRouteEnter:function(t,e,a){a(function(e){e.q=t.query.q||"",e.starttime=t.query.starttime||"",e.endtime=t.query.endtime||"",e.method=t.query.method||"",e.total=0,e.currentPage=parseInt(t.params.page)||1,e.ready()})},beforeRouteUpdate:function(t,e,a){p.forEach(function(t){return t()}),p.length=0,a(),this.q=t.query.q||"",this.starttime=t.query.starttime||"",this.endtime=t.query.endtime||"",this.method=t.query.method||"",this.total=0,this.currentPage=parseInt(t.params.page)||1,this.getLogs(),this.ready()}}}).call(e,a("0iPh"))},IEpb:function(t,e,a){var r=a("G5yr");"string"==typeof r&&(r=[[t.i,r,""]]),r.locals&&(t.exports=r.locals);a("rjj0")("47dd6f6e",r,!0,{})},"M+76":function(t,e,a){"use strict";function r(t){return t&&t.__esModule?t:{default:t}}function o(t){return function(){var e=t.apply(this,arguments);return new Promise(function(t,a){function r(o,i){try{var n=e[o](i),s=n.value}catch(t){return void a(t)}if(!n.done)return Promise.resolve(s).then(function(t){r("next",t)},function(t){r("throw",t)});t(s)}return r("next")})}}Object.defineProperty(e,"__esModule",{value:!0});var i=a("A9K1"),n=r(i),s=a("0iPh"),l=r(s);e.default={data:function(){return{filter:!0,start:0,limit:1e4}},components:{FormDlg:n.default},methods:{onHide:function(){this.filter=!0,this.start=0,this.limit=1e4,this.$emit("hide")},onShow:function(){this.errors.clear(),this.$emit("show")},onSubmit:function(){var t=this;return o(regeneratorRuntime.mark(function e(){var a,r,o,i,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.$validator.validateAll();case 2:if(a=e.sent){e.next=8;break}return r=t.errors.items[0],t.$message({type:"error",message:r.msg}),(0,l.default)("[name="+r.field+"]").focus(),e.abrupt("return");case 8:o=t.filter,i=t.start,n=t.limit,t.$refs.dlg.hide(),t.$emit("submit",o,i,n);case 13:case"end":return e.stop()}},e,t)}))()},show:function(){this.errors.clear(),this.$refs.dlg.show()}}}},WEd6:function(t,e,a){"use strict";function r(t){a("IEpb")}Object.defineProperty(e,"__esModule",{value:!0});var o=a("49HP"),i=a.n(o);for(var n in o)["default","default"].indexOf(n)<0&&function(t){a.d(e,t,function(){return o[t]})}(n);var s=a("u/lO"),l=a("VU/8"),u=r,c=l(i.a,s.a,!1,u,null,null);e.default=c.exports},XwT2:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=a("M+76"),o=a.n(r);for(var i in r)["default","default"].indexOf(i)<0&&function(t){a.d(e,t,function(){return r[t]})}(i);var n=a("oska"),s=a("VU/8"),l=s(o.a,n.a,!1,null,null,null);e.default=l.exports},kiFS:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=a("I/0/"),o=a.n(r);for(var i in r)["default","default"].indexOf(i)<0&&function(t){a.d(e,t,function(){return r[t]})}(i);var n=a("2X2r"),s=a("VU/8"),l=s(o.a,n.a,!1,null,null,null);e.default=l.exports},oska:function(t,e,a){"use strict";var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("FormDlg",{ref:"dlg",attrs:{title:"导出操作日志列表",disabled:t.errors.any()},on:{hide:t.onHide,show:t.onShow,submit:t.onSubmit}},[a("div",{class:{"form-group":!0}},[a("div",{staticClass:"col-sm-12 checkbox text-center"},[a("el-checkbox",{staticStyle:{"margin-left":"-19px","margin-top":"-5px"},model:{value:t.filter,callback:function(e){t.filter="string"==typeof e?e.trim():e},expression:"filter"}},[t._v("\n                通过当前查询条件过滤后导出\n            ")])],1)]),t._v(" "),a("div",{class:{"form-group":!0,"has-error":t.errors.has("start")}},[a("label",{staticClass:"col-sm-3 control-label",attrs:{for:"input-start"}},[t._v("开始\n            "),a("span",{staticClass:"text-red"},[t._v("*")])]),t._v(" "),a("div",{staticClass:"col-sm-7"},[a("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.start,expression:"start",modifiers:{trim:!0}},{name:"validate",rawName:"v-validate",value:"numeric|min_value:0",expression:"'numeric|min_value:0'"}],staticClass:"form-control",attrs:{type:"text",id:"input-start",name:"start","data-vv-as":"开始"},domProps:{value:t.start},on:{input:function(e){e.target.composing||(t.start=e.target.value.trim())},blur:function(e){t.$forceUpdate()}}})])]),t._v(" "),a("div",{class:{"form-group":!0,"has-error":t.errors.has("limit")}},[a("label",{staticClass:"col-sm-3 control-label",attrs:{for:"input-limit"}},[t._v("上限\n            "),a("span",{staticClass:"text-red"},[t._v("*")])]),t._v(" "),a("div",{staticClass:"col-sm-7"},[a("input",{directives:[{name:"model",rawName:"v-model.trim",value:t.limit,expression:"limit",modifiers:{trim:!0}},{name:"validate",rawName:"v-validate",value:"numeric|min_value:1",expression:"'numeric|min_value:1'"}],staticClass:"form-control",attrs:{type:"text",id:"input-limit",name:"limit","data-vv-as":"上限"},domProps:{value:t.limit},on:{input:function(e){e.target.composing||(t.limit=e.target.value.trim())},blur:function(e){t.$forceUpdate()}}})])])])},o=[],i={render:r,staticRenderFns:o};e.a=i},"u/lO":function(t,e,a){"use strict";var r=function(){var t=this,e=t.$createElement;return(t._self._c||e)("input",{attrs:{type:"text",placeholder:t.placeholder}})},o=[],i={render:r,staticRenderFns:o};e.a=i}});